# Configuration LibreSpeed pour Cloudflare SSL - Updated
http:
  routers:
    # Route pour les challenges Let's Encrypt (si n√©cessaire)
    librespeed-acme:
      rule: "Host(`librespeed.iahome.fr`) && PathPrefix(`/.well-known/acme-challenge`)"
      entryPoints: ["web"]
      service: librespeed-direct
      priority: 1000

    # Route principale pour LibreSpeed (avec redirection)
    librespeed-main:
      rule: "Host(`librespeed.iahome.fr`)"
      entryPoints: ["websecure"]
      service: librespeed-redirect-service
      middlewares: ["security-headers@file", "compress@file"]
      tls: {}
      priority: 200

  services:
    # Service pour les challenges Let's Encrypt
    librespeed-direct:
      loadBalancer:
        servers:
          - url: "http://librespeed:80"

    # Service principal pour LibreSpeed
    librespeed-service:
      loadBalancer:
        servers:
          - url: "http://librespeed-secure:80"

    # Service proxy d'authentification pour LibreSpeed
    librespeed-proxy-service:
      loadBalancer:
        servers:
          - url: "http://librespeed-secure:80"

    # Service de redirection pour LibreSpeed
    librespeed-redirect-service:
      loadBalancer:
        servers:
          - url: "http://iahome-app:3000/api/librespeed-redirect"

# Force reload 09/20/2025 10:40:29
# Force reload 09/20/2025 10:59:54

# Configuration Traefik pour Meeting Reports Generator
# Placez ce fichier dans votre répertoire traefik/dynamic/

http:
  routers:
    meeting-reports:
      rule: "Host(`meeting-reports.iahome.fr`) && !PathPrefix(`/api`) && !PathPrefix(`/.well-known/acme-challenge`)"
      service: meeting-reports-service
      entryPoints:
        - websecure
        - web
      tls:
        certResolver: letsencrypt
      middlewares:
        - meeting-reports-headers
      priority: 200  # Priorité élevée pour passer avant la route de redirection

  services:
    meeting-reports-service:
      loadBalancer:
        servers:
          - url: "http://host.docker.internal:3050"  # Utiliser Nginx qui fait déjà le reverse proxy
        healthCheck:
          path: "/"
          interval: "30s"
          timeout: "10s"
        passHostHeader: true

  middlewares:
    meeting-reports-headers:
      headers:
        customRequestHeaders:
          X-Forwarded-Proto: "https"
          X-Forwarded-For: ""
        customResponseHeaders:
          X-Frame-Options: "SAMEORIGIN"
          X-Content-Type-Options: "nosniff"
          Referrer-Policy: "strict-origin-when-cross-origin"


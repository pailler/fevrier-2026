# Configuration Converter directe avec authentification par token
http:
  routers:
    # Route directe vers Converter avec vérification de token
    converter-direct:
      rule: "Host(`convert.iahome.fr`)"
      entryPoints: ["websecure"]
      service: converter-service
      middlewares: ["converter-token-check", "security-headers", "compress"]
      tls:
        certResolver: letsencrypt
      priority: 100

    # Route HTTP vers HTTPS
    converter-http-redirect:
      rule: "Host(`convert.iahome.fr`)"
      entryPoints: ["web"]
      middlewares: ["redirect-to-https"]
      service: converter-service
      priority: 50

  services:
    # Service Converter direct
    converter-service:
      loadBalancer:
        servers:
          - url: "http://universal-converter:8080"
        passHostHeader: true

  middlewares:
    # Vérification de token pour Converter
    converter-token-check:
      forwardAuth:
        address: "http://iahome-app:3000/api/converter-token-validator"
        trustForwardHeader: true
        authResponseHeaders: ["X-User-Email", "X-Access-Type"]
    
    # Headers de sécurité
    security-headers:
      headers:
        customResponseHeaders:
          Strict-Transport-Security: "max-age=31536000; includeSubDomains; preload"
          X-Content-Type-Options: "nosniff"
          X-Frame-Options: "SAMEORIGIN"
          X-XSS-Protection: "1; mode=block"
          Referrer-Policy: "strict-origin-when-cross-origin"
          Permissions-Policy: "camera=(), microphone=(), geolocation=()"
    
    # Compression
    compress:
      compress: {}
    
    # Redirection HTTP vers HTTPS
    redirect-to-https:
      redirectScheme:
        scheme: "https"
        permanent: true

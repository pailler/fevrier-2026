# Configuration MeTube pour Cloudflare SSL - Updated
http:
  middlewares:
    # Middleware de redirection vers login pour MeTube
    metube-redirect-to-login:
      redirectRegex:
        regex: "^https://metube\\.iahome\\.fr(.*)$"
        replacement: "https://iahome.fr/login"
        permanent: false

  routers:
    # Route pour les challenges Let's Encrypt (si n√©cessaire)
    metube-acme:
      rule: "Host(`metube.iahome.fr`) && PathPrefix(`/.well-known/acme-challenge`)"
      entryPoints: ["web"]
      service: metube-direct
      priority: 1000

    # Route principale pour MeTube (avec redirection)
    metube-main:
      rule: "Host(`metube.iahome.fr`)"
      entryPoints: ["websecure"]
      service: metube-redirect-service
      middlewares: ["metube-redirect-to-login"]
      tls: {}
      priority: 1

  services:
    # Service pour les challenges Let's Encrypt
    metube-direct:
      loadBalancer:
        servers:
          - url: "http://metube:80"

    # Service principal pour MeTube
    metube-service:
      loadBalancer:
        servers:
          - url: "http://metube-secure:80"

    # Service proxy d'authentification pour MeTube
    metube-proxy-service:
      loadBalancer:
        servers:
          - url: "http://metube-secure:80"

    # Service de redirection pour MeTube
    metube-redirect-service:
      loadBalancer:
        servers:
          - url: "http://iahome-app:3000/login"
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob:; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline'; img-src 'self' data: blob:; font-src 'self' data:; connect-src 'self' http://localhost:7006 https://qrcodes.iahome.fr;">
    <title>G√©n√©rateur de QR Codes Dynamiques - IAHome</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }

        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        /* Workflow Container */
        .workflow-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        /* Progress Indicators */
        .progress-indicators {
            display: flex;
            justify-content: space-between;
            padding: 30px;
            background: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
        }

        .progress-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
            position: relative;
        }

        .progress-step:not(:last-child)::after {
            content: '';
            position: absolute;
            top: 20px;
            right: -50%;
            width: 100%;
            height: 2px;
            background: #e2e8f0;
            z-index: 1;
        }

        .progress-step.active:not(:last-child)::after {
            background: #3b82f6;
        }

        .step-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #e2e8f0;
            color: #64748b;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 1.1rem;
            position: relative;
            z-index: 2;
            transition: all 0.3s ease;
        }

        .progress-step.active .step-circle {
            background: #3b82f6;
            color: white;
        }

        .progress-step.completed .step-circle {
            background: #10b981;
            color: white;
        }

        .step-label {
            margin-top: 10px;
            font-size: 0.9rem;
            font-weight: 500;
            text-align: center;
            color: #64748b;
        }

        .progress-step.active .step-label {
            color: #3b82f6;
        }

        .progress-step.completed .step-label {
            color: #10b981;
        }

        /* Workflow Content */
        .workflow-content {
            padding: 40px;
            min-height: 600px;
        }

        .workflow-content.active {
            display: block;
        }

        .workflow-content:not(.active) {
            display: none;
        }

        /* Step Content */
        .step-title {
            font-size: 2rem;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 20px;
            text-align: center;
        }

        .step-description {
            font-size: 1.1rem;
            color: #64748b;
            text-align: center;
            margin-bottom: 40px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #1e293b;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #3b82f6;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .size-selector {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .size-btn {
            padding: 12px 24px;
            border: 2px solid #e2e8f0;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .size-btn:hover {
            border-color: #3b82f6;
            color: #3b82f6;
        }

        .size-btn.selected {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }

        /* Style Cards */
        .style-card {
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }

        .style-card:hover {
            border-color: #3b82f6;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);
        }

        .style-card.selected {
            border-color: #3b82f6;
            background: #eff6ff;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);
        }

        .style-card h3 {
            color: #1e293b;
            margin-bottom: 10px;
            font-size: 1.2rem;
        }

        .style-card p {
            color: #64748b;
            margin-bottom: 15px;
        }

        .style-card ul {
            color: #64748b;
            margin-left: 20px;
        }

        .style-card li {
            margin-bottom: 5px;
        }

        .color-picker {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .color-input {
            width: 60px;
            height: 60px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            border: 3px solid #e2e8f0;
        }

        .logo-upload {
            border: 2px dashed #e2e8f0;
            border-radius: 8px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .logo-upload:hover {
            border-color: #3b82f6;
            background: #f8fafc;
        }

        .logo-upload.dragover {
            border-color: #3b82f6;
            background: #eff6ff;
        }

        .logo-preview {
            max-width: 200px;
            max-height: 200px;
            margin: 20px auto;
            display: block;
            border-radius: 8px;
        }

        /* Dynamic QR Options */
        .dynamic-options {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
        }

        .dynamic-options h3 {
            color: #1e293b;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .dynamic-options p {
            color: #64748b;
            margin-bottom: 15px;
        }

        .dynamic-options ul {
            color: #64748b;
            margin-left: 20px;
            margin-bottom: 15px;
        }

        .dynamic-options li {
            margin-bottom: 5px;
        }

        /* QR Code Preview */
        .qr-preview {
            text-align: center;
            margin: 40px 0;
        }

        .qr-preview img {
            max-width: 300px;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .qr-preview-placeholder {
            width: 300px;
            height: 300px;
            border: 2px dashed #e2e8f0;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
            color: #64748b;
            font-size: 1.1rem;
        }

        /* Management Info */
        .management-info {
            background: #f0f9ff;
            border: 2px solid #0ea5e9;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
        }

        .management-info h3 {
            color: #0c4a6e;
            margin-bottom: 15px;
        }

        .management-info p {
            color: #0c4a6e;
            margin-bottom: 10px;
        }

        .management-info .token {
            background: #e0f2fe;
            padding: 10px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 0.9rem;
            word-break: break-all;
            margin: 10px 0;
        }

        .management-info .url {
            background: #e0f2fe;
            padding: 10px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 0.9rem;
            word-break: break-all;
            margin: 10px 0;
        }

        /* Styles pour l'√©tape finale */
        .final-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .action-card {
            background: #ffffff;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 25px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .action-card:hover {
            border-color: #007bff;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,123,255,0.15);
        }

        .action-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }

        .action-card h3 {
            margin: 0 0 10px 0;
            color: #495057;
            font-size: 1.2rem;
        }

        .action-card p {
            margin: 0;
            color: #6c757d;
            font-size: 0.9rem;
        }

        .qr-summary {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 25px;
            margin: 30px 0;
        }

        .qr-summary h3 {
            margin-top: 0;
            color: #495057;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }

        .summary-content p {
            margin: 10px 0;
            color: #495057;
        }

        .summary-content strong {
            color: #212529;
        }

        .nav-btn.finish {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            border: none;
            font-weight: 600;
        }

        .nav-btn.finish:hover {
            background: linear-gradient(135deg, #218838, #1ea085);
            transform: translateY(-1px);
        }

        /* Navigation */
        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 30px;
            background: #f8fafc;
            border-top: 1px solid #e2e8f0;
        }

        .nav-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .nav-btn.prev {
            background: #e2e8f0;
            color: #64748b;
        }

        .nav-btn.prev:hover {
            background: #cbd5e1;
        }

        .nav-btn.next {
            background: #3b82f6;
            color: white;
        }

        .nav-btn.next:hover {
            background: #2563eb;
        }

        .nav-btn.generate {
            background: #10b981;
            color: white;
        }

        .nav-btn.generate:hover {
            background: #059669;
        }

        .nav-btn.finalize {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            font-weight: bold;
            font-size: 16px;
            padding: 12px 24px;
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
            border: 2px solid #f59e0b;
        }

        .nav-btn.finalize:hover {
            background: linear-gradient(135deg, #d97706, #b45309);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(245, 158, 11, 0.4);
        }

        /* Error Messages */
        .error-message {
            background: #fef2f2;
            border: 2px solid #fca5a5;
            color: #dc2626;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
        }

        /* Success Messages */
        .success-message {
            background: #f0fdf4;
            border: 2px solid #86efac;
            color: #16a34a;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .progress-indicators {
                padding: 20px 10px;
            }

            .step-circle {
                width: 30px;
                height: 30px;
                font-size: 0.9rem;
            }

            .step-label {
                font-size: 0.8rem;
            }

            .workflow-content {
            padding: 20px;
        }

            .step-title {
                font-size: 1.5rem;
            }

            .size-selector {
                flex-direction: column;
            }

            .color-picker {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéØ G√©n√©rateur de QR Codes Dynamiques</h1>
            <p>Cr√©ez des QR codes personnalis√©s avec IAHome</p>
        </div>

        <div class="workflow-container">
            <!-- Progress Indicators -->
            <div class="progress-indicators">
                <div class="progress-step" data-step="1">
                    <div class="step-circle">1</div>
                    <div class="step-label">Style</div>
                        </div>
                <div class="progress-step" data-step="2">
                    <div class="step-circle">2</div>
                    <div class="step-label">Contenu</div>
                        </div>
                <div class="progress-step" data-step="3">
                    <div class="step-circle">3</div>
                    <div class="step-label">Taille</div>
                        </div>
                <div class="progress-step" data-step="4">
                    <div class="step-circle">4</div>
                    <div class="step-label">Couleurs</div>
                        </div>
                <div class="progress-step" data-step="5">
                    <div class="step-circle">5</div>
                    <div class="step-label">Logo</div>
                        </div>
                <div class="progress-step" data-step="6">
                    <div class="step-circle">6</div>
                    <div class="step-label">Personnalisation</div>
                        </div>
                <div class="progress-step" data-step="7">
                    <div class="step-circle">7</div>
                    <div class="step-label">Configuration</div>
                        </div>
                <div class="progress-step" data-step="8">
                    <div class="step-circle">8</div>
                    <div class="step-label">QR Dynamique</div>
                    </div>
                <div class="progress-step" data-step="9">
                    <div class="step-circle">9</div>
                    <div class="step-label">Final</div>
                    </div>
                </div>

            <!-- Step 1: Style Selection -->
            <div class="workflow-content active" id="step-1">
                <h2 class="step-title">1. Choisissez le style de votre QR code</h2>
                <p class="step-description">S√©lectionnez le type de QR code que vous souhaitez cr√©er</p>
                
                    <div class="form-group">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                        <div class="style-card" data-style="static">
                            <h3>QR Code Statique</h3>
                            <p>QR code simple avec contenu fixe</p>
                            <ul>
                                <li>URL, texte, email</li>
                                <li>Personnalisation visuelle</li>
                            </ul>
                    </div>
                        <div class="style-card" data-style="dynamic">
                            <h3>QR Code Dynamique</h3>
                            <p>QR code avec gestion et statistiques</p>
                            <ul>
                                <li>Modification du contenu</li>
                                <li>Statistiques de scan</li>
                                <li>Token de gestion</li>
                            </ul>
                </div>
                    </div>
                    </div>

                <!-- Navigation -->
                <div class="navigation">
                    <button id="prevBtn" class="nav-btn prev" style="display: none;">‚Üê Pr√©c√©dent</button>
                    <button id="nextBtn" class="nav-btn next">Suivant ‚Üí</button>
                </div>
            </div>

            <!-- Step 2: Content Input -->
            <div class="workflow-content" id="step-2">
                <h2 class="step-title">2. Saisissez le contenu</h2>
                <p class="step-description">Entrez le contenu que vous souhaitez encoder dans le QR code</p>
                
                    <div class="form-group">
                    <label for="content-type">Type de contenu :</label>
                    <select id="content-type">
                        <option value="url">URL</option>
                        <option value="text">Texte</option>
                        <option value="email">Email</option>
                        <option value="phone">T√©l√©phone</option>
                        <option value="sms">SMS</option>
                        <option value="vcard">vCard</option>
                        <option value="wifi">WiFi</option>
                        <option value="location">Localisation</option>
                    </select>
                </div>

                    <div class="form-group">
                    <label for="content-input">Contenu :</label>
                    <textarea id="content-input" placeholder="Entrez votre contenu ici..."></textarea>
                    </div>

                <!-- Navigation -->
                <div class="navigation">
                    <button id="prevBtn" class="nav-btn prev">‚Üê Pr√©c√©dent</button>
                    <button id="nextBtn" class="nav-btn next">Suivant ‚Üí</button>
                </div>
            </div>

            <!-- Step 3: Size Selection -->
            <div class="workflow-content" id="step-3">
                <h2 class="step-title">3. Choisissez la taille</h2>
                <p class="step-description">S√©lectionnez la taille de votre QR code</p>
                
                        <div class="form-group">
                    <div class="size-selector">
                        <button class="size-btn" data-size="200">200px</button>
                        <button class="size-btn selected" data-size="300">300px</button>
                        <button class="size-btn" data-size="400">400px</button>
                        <button class="size-btn" data-size="500">500px</button>
                        </div>
                        </div>

                <!-- Navigation -->
                <div class="navigation">
                    <button id="prevBtn" class="nav-btn prev">‚Üê Pr√©c√©dent</button>
                    <button id="nextBtn" class="nav-btn next">Suivant ‚Üí</button>
                </div>
            </div>

            <!-- Step 4: Colors -->
            <div class="workflow-content" id="step-4">
                <h2 class="step-title">4. Personnalisez les couleurs</h2>
                <p class="step-description">Choisissez les couleurs de votre QR code</p>
                
                    <div class="form-group">
                    <div class="color-picker">
                        <div>
                            <label>Couleur du QR code :</label>
                            <input type="color" class="color-input" id="foreground-color" value="#000000">
                    </div>
                        <div>
                            <label>Couleur de fond :</label>
                            <input type="color" class="color-input" id="background-color" value="#FFFFFF">
                    </div>
                    </div>
                    </div>

                <!-- Navigation -->
                <div class="navigation">
                    <button id="prevBtn" class="nav-btn prev">‚Üê Pr√©c√©dent</button>
                    <button id="nextBtn" class="nav-btn next">Suivant ‚Üí</button>
                </div>
            </div>

            <!-- Step 5: Logo Upload -->
            <div class="workflow-content" id="step-5">
                <h2 class="step-title">5. Ajoutez un logo (optionnel)</h2>
                <p class="step-description">T√©l√©chargez un logo √† int√©grer dans votre QR code</p>
                
                    <div class="form-group">
                    <div class="logo-upload" id="logo-upload">
                        <p>Cliquez pour ajouter un logo</p>
                        <p style="font-size: 0.9rem; color: #64748b;">Formats support√©s : PNG, JPG, GIF, SVG (max 2MB)</p>
                        <input type="file" id="logo-input" accept="image/*" style="display: none;">
                    </div>
                    <div id="logo-preview" style="display: none;">
                        <img id="logo-preview-img" class="logo-preview" alt="Logo preview">
                        <button id="removeLogoBtn" style="margin-top: 10px; padding: 8px 16px; background: #ef4444; color: white; border: none; border-radius: 6px; cursor: pointer;">Supprimer le logo</button>
                    </div>
                    </div>

                <!-- Navigation -->
                <div class="navigation">
                    <button id="prevBtn" class="nav-btn prev">‚Üê Pr√©c√©dent</button>
                    <button id="nextBtn" class="nav-btn next">Suivant ‚Üí</button>
                </div>
            </div>

            <!-- Step 6: Customization -->
            <div class="workflow-content" id="step-6">
                <h2 class="step-title">6. Personnalisation avanc√©e</h2>
                <p class="step-description">Ajustez les param√®tres avanc√©s de votre QR code</p>
                
                    <div class="form-group">
                    <label for="error-correction">Correction d'erreur :</label>
                    <select id="error-correction">
                        <option value="L">Faible (7%)</option>
                        <option value="M" selected>Moyenne (15%)</option>
                        <option value="Q">√âlev√©e (25%)</option>
                        <option value="H">Tr√®s √©lev√©e (30%)</option>
                        </select>
                    </div>

                        <div class="form-group">
                    <label for="margin">Marge :</label>
                    <input type="range" id="margin" min="1" max="10" value="4">
                    <span id="margin-value">4</span>
                    </div>

                <!-- Navigation -->
                <div class="navigation">
                    <button id="prevBtn" class="nav-btn prev">‚Üê Pr√©c√©dent</button>
                    <button id="nextBtn" class="nav-btn next">Suivant ‚Üí</button>
                </div>
            </div>

            <!-- Step 7: Configuration -->
            <div class="workflow-content" id="step-7">
                <h2 class="step-title">7. Configuration finale</h2>
                <p class="step-description">Configurez les param√®tres finaux de votre QR code</p>
                
                                    <div class="form-group">
                    <label for="qr-name">Nom du QR code :</label>
                    <input type="text" id="qr-name" placeholder="Mon QR code">
                                    </div>

                <div id="dynamic-options" class="dynamic-options" style="display: none;">
                    <h3>üîó QR Code Dynamique</h3>
                    <p>Votre QR code sera dynamique et vous permettra de :</p>
                    <ul>
                        <li>Modifier le contenu √† tout moment</li>
                        <li>Consulter les statistiques de scan</li>
                    <li>G√©rer votre QR code avec un token unique</li>
                </ul>
                </div>

                <!-- Navigation -->
                <div class="navigation">
                    <button id="prevBtn" class="nav-btn prev">‚Üê Pr√©c√©dent</button>
                    <button id="nextBtn" class="nav-btn next">Suivant ‚Üí</button>
                </div>
            </div>

            <!-- QR Code Preview sera affich√© √† l'√©tape 8 -->

            <!-- Step 8: Dynamic QR Code -->
            <div class="workflow-content" id="step-8">
                <h2 class="step-title">8. QR Code Dynamique</h2>
                <p class="step-description">Cr√©ez votre QR code dynamique avec gestion avanc√©e</p>
                
                <div class="form-group">
                    <div class="qr-preview">
                        <div class="qr-preview-placeholder" id="qr-preview-placeholder">
                            Votre QR code dynamique appara√Ætra ici
                        </div>
                        <img id="qr-preview-img" style="display: none;" alt="QR Code Preview">
                    </div>
                </div>

                <div id="management-info" class="management-info" style="display: none;">
                    <h3>üîë Informations de gestion</h3>
                    <p><strong>Token de gestion :</strong></p>
                    <div class="token" id="management-token"></div>
                    <p><strong>URL de gestion :</strong></p>
                    <div class="url" id="management-url"></div>
                    <p><strong>URL de redirection :</strong></p>
                    <div class="url" id="redirect-url"></div>
                    </div>
                </div>

                <!-- Navigation -->
                <div class="navigation">
                    <button id="prevBtn" class="nav-btn prev">‚Üê Pr√©c√©dent</button>
                    <button id="nextBtn" class="nav-btn next">Suivant ‚Üí</button>
                </div>
            </div>

            <!-- Step 9: Final Step -->
            <div class="workflow-content" id="step-9">
                <h2 class="step-title">‚úÖ QR Code Cr√©√© avec Succ√®s !</h2>
                <p class="step-description">Votre QR code est pr√™t. Que souhaitez-vous faire maintenant ?</p>
                
                <!-- Afficher le QR code g√©n√©r√© -->
                <div class="qr-preview-final" style="text-align: center; margin: 30px 0;">
                    <div id="qr-preview-placeholder-final" style="display: none; padding: 40px; color: #64748b;">
                        <p>G√©n√©ration du QR code en cours...</p>
                    </div>
                    <img id="qr-preview-img-final" style="display: none; max-width: 400px; margin: 20px auto; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);" alt="QR Code Final">
                </div>
                
                <div class="final-actions">
                    <div class="action-card" id="downloadActionCard">
                        <div class="action-icon">üì•</div>
                        <h3>T√©l√©charger</h3>
                        <p>T√©l√©chargez votre QR code en PNG</p>
                    </div>
                    
                    <div class="action-card" id="shareActionCard">
                        <div class="action-icon">üîó</div>
                        <h3>Partager</h3>
                        <p>Copiez le lien de votre QR code</p>
                    </div>
                    
                    <div class="action-card" id="manageActionCard">
                        <div class="action-icon">‚öôÔ∏è</div>
                        <h3>G√©rer</h3>
                        <p>Modifiez votre QR code dynamique</p>
                    </div>
                    
                    <div class="action-card" id="newActionCard">
                        <div class="action-icon">‚ûï</div>
                        <h3>Nouveau QR Code</h3>
                        <p>Cr√©ez un autre QR code</p>
                    </div>
                </div>

                <div class="qr-summary" id="qr-summary" style="display: none;">
                    <h3>üìã R√©sum√© de votre QR Code</h3>
                    <div class="summary-content">
                        <p><strong>Type :</strong> <span id="summary-type"></span></p>
                        <p><strong>Contenu :</strong> <span id="summary-content"></span></p>
                        <p><strong>Taille :</strong> <span id="summary-size"></span>px</p>
                        <p><strong>Couleurs :</strong> <span id="summary-colors"></span></p>
                        <div id="summary-management" style="display: none;">
                            <p><strong>URL de gestion :</strong> <span id="summary-management-url"></span></p>
                            <p><strong>URL de redirection :</strong> <span id="summary-redirect-url"></span></p>
                        </div>
                    </div>
                </div>

                <!-- Navigation -->
                <div class="navigation">
                    <button id="prevBtn" class="nav-btn prev">‚Üê Retour</button>
                    <button id="finishBtn" class="nav-btn finish">Terminer</button>
                </div>
            </div>

    <script>
        // √âtat du workflow
        let currentStep = 1;
        let workflowState = {
            style: null,
            content: '',
            contentType: 'url',
            size: 300,
            foregroundColor: '#000000',
            backgroundColor: '#FFFFFF',
            logo: null,
            errorCorrection: 'M',
            margin: 4,
            name: '',
            isDynamic: false
        };

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            // Cacher toutes les navigations sauf celle du step 1
            document.querySelectorAll('.navigation').forEach(nav => {
                nav.style.display = 'none'; // Cacher toutes par d√©faut
            });
            
            // Afficher uniquement la navigation du step 1
            const step1 = document.getElementById('step-1');
            if (step1) {
                const step1Navigation = step1.querySelector('.navigation');
                if (step1Navigation) {
                    step1Navigation.style.display = 'flex';
                }
            }
            
            initializeWorkflow();
            setupEventListeners();
            updateProgressIndicators();
            updateNavigation();
            updateContentPlaceholder(); // Initialiser le placeholder
        });

        function initializeWorkflow() {
            // Style cards
            document.querySelectorAll('.style-card').forEach(card => {
                card.addEventListener('click', function() {
                    document.querySelectorAll('.style-card').forEach(c => c.classList.remove('selected'));
                    this.classList.add('selected');
                    workflowState.style = this.dataset.style;
                    workflowState.isDynamic = this.dataset.style === 'dynamic';
                    
                    // Afficher/masquer les options dynamiques
                    const dynamicOptions = document.getElementById('dynamic-options');
                    if (workflowState.isDynamic) {
                        dynamicOptions.style.display = 'block';
                    } else {
                        dynamicOptions.style.display = 'none';
                    }
                });
            });

            // Size buttons
            document.querySelectorAll('.size-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.size-btn').forEach(b => b.classList.remove('selected'));
                    this.classList.add('selected');
                    workflowState.size = parseInt(this.dataset.size);
                });
            });

            // Color inputs
            document.getElementById('foreground-color').addEventListener('change', function() {
                workflowState.foregroundColor = this.value;
            });

            document.getElementById('background-color').addEventListener('change', function() {
                workflowState.backgroundColor = this.value;
            });

            // Content type
            document.getElementById('content-type').addEventListener('change', function() {
                workflowState.contentType = this.value;
                updateContentPlaceholder();
            });

            // Content input
            document.getElementById('content-input').addEventListener('input', function() {
                workflowState.content = this.value;
            });

            // Error correction
            document.getElementById('error-correction').addEventListener('change', function() {
                workflowState.errorCorrection = this.value;
            });

            // Margin slider
            document.getElementById('margin').addEventListener('input', function() {
                workflowState.margin = parseInt(this.value);
                document.getElementById('margin-value').textContent = this.value;
            });

            // QR name
            document.getElementById('qr-name').addEventListener('input', function() {
                workflowState.name = this.value;
            });

            // Email supprim√© - plus n√©cessaire
        }

        function setupEventListeners() {
            // Logo upload
            const logoUpload = document.getElementById('logo-upload');
            const logoInput = document.getElementById('logo-input');

            logoUpload.addEventListener('click', () => logoInput.click());
            logoUpload.addEventListener('dragover', handleDragOver);
            logoUpload.addEventListener('drop', handleDrop);
            logoInput.addEventListener('change', handleLogoUpload);

            // Navigation buttons
            document.querySelectorAll('#prevBtn').forEach(btn => {
                btn.addEventListener('click', prevStep);
            });
            document.querySelectorAll('#nextBtn').forEach(btn => {
                btn.addEventListener('click', nextStep);
            });
            document.querySelectorAll('#finishBtn').forEach(btn => {
                btn.addEventListener('click', finishWorkflow);
            });

            // Remove logo button
            const removeLogoBtn = document.getElementById('removeLogoBtn');
            if (removeLogoBtn) {
                removeLogoBtn.addEventListener('click', removeLogo);
            }

            // Action cards
            const downloadActionCard = document.getElementById('downloadActionCard');
            if (downloadActionCard) {
                downloadActionCard.addEventListener('click', downloadCurrentQRCode);
            }

            const shareActionCard = document.getElementById('shareActionCard');
            if (shareActionCard) {
                shareActionCard.addEventListener('click', shareQRCode);
            }

            const manageActionCard = document.getElementById('manageActionCard');
            if (manageActionCard) {
                manageActionCard.addEventListener('click', manageQRCode);
            }

            const newActionCard = document.getElementById('newActionCard');
            if (newActionCard) {
                newActionCard.addEventListener('click', createNewQRCode);
            }
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.currentTarget.classList.add('dragover');
        }

        function handleDrop(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleLogoFile(files[0]);
            }
        }

        function handleLogoUpload(e) {
            const file = e.target.files[0];
            if (file) {
                handleLogoFile(file);
            }
        }

        function handleLogoFile(file) {
                if (file.size > 2 * 1024 * 1024) {
                alert('Le fichier est trop volumineux (max 2MB)');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                workflowState.logo = e.target.result;
                document.getElementById('logo-preview-img').src = e.target.result;
                    document.getElementById('logo-preview').style.display = 'block';
                document.getElementById('logo-upload').style.display = 'none';
                };
                reader.readAsDataURL(file);
            }

        function removeLogo() {
            workflowState.logo = null;
            document.getElementById('logo-preview').style.display = 'none';
            document.getElementById('logo-upload').style.display = 'block';
            document.getElementById('logo-input').value = '';
        }

        function nextStep() {
            if (!validateCurrentStep()) {
                return;
            }
            
            // Si on est √† l'√©tape 7 pour un QR statique, g√©n√©rer directement
            if (currentStep === 7 && !workflowState.isDynamic) {
                console.log('Etape 7 - Generation QR statique...');
                const activeStep = document.querySelector('.workflow-content.active');
                const nextBtn = activeStep ? (activeStep.querySelector('#nextBtn') || activeStep.querySelector('.nav-btn.next')) : null;
                        if (nextBtn) {
                            nextBtn.disabled = true;
                            nextBtn.textContent = 'G√©n√©ration en cours...';
                        }
                        
                generateStaticQRCode().then(() => {
                    console.log('QR statique genere, passage a etape 9');
                    // S'assurer que le QR code est bien g√©n√©r√© avant de passer √† l'√©tape 9
                    if (currentQRCodeData) {
                                currentStep = 9;
                                showStep(currentStep);
                                updateProgressIndicators();
                                updateNavigation();
                                showFinalSummary();
                    } else {
                        showError('Le QR code n\'a pas pu √™tre g√©n√©r√©. Veuillez r√©essayer.');
                        const activeStep = document.querySelector('.workflow-content.active');
                        const retryBtn = activeStep ? (activeStep.querySelector('#nextBtn') || activeStep.querySelector('.nav-btn.next')) : null;
                        if (retryBtn) {
                            retryBtn.disabled = false;
                            retryBtn.textContent = 'G√©n√©rer ‚Üí';
                        }
                    }
                            }).catch((error) => {
                    console.error('Erreur generation QR statique:', error);
                    showError('Erreur lors de la g√©n√©ration du QR code statique');
                    const activeStep = document.querySelector('.workflow-content.active');
                    const retryBtn = activeStep ? (activeStep.querySelector('#nextBtn') || activeStep.querySelector('.nav-btn.next')) : null;
                    if (retryBtn) {
                        retryBtn.disabled = false;
                        retryBtn.textContent = 'G√©n√©rer ‚Üí';
                                }
                            });
                return;
            }
            
            // Si on est √† l'√©tape 7 pour un QR dynamique, passer √† l'√©tape 8
            if (currentStep === 7 && workflowState.isDynamic) {
                currentStep = 8;
                showStep(currentStep);
                updateProgressIndicators();
                updateNavigation();
                
                // G√©n√©rer automatiquement √† l'√©tape 8
                console.log('Etape 8 atteinte, generation QR dynamique...');
                const activeStep = document.querySelector('.workflow-content.active');
                const nextBtn = activeStep ? (activeStep.querySelector('#nextBtn') || activeStep.querySelector('.nav-btn.next')) : null;
                if (nextBtn) {
                    nextBtn.disabled = true;
                    nextBtn.textContent = 'G√©n√©ration en cours...';
                }
                
                generateDynamicQRCode().then(() => {
                    console.log('QR dynamique genere, verification avant passage a etape 9');
                    console.log('currentQRCodeData existe:', !!currentQRCodeData);
                    console.log('currentQRCodeData longueur:', currentQRCodeData ? currentQRCodeData.length : 0);
                    
                    // Attendre un peu pour s'assurer que les donn√©es sont bien stock√©es
                    setTimeout(() => {
                        // S'assurer que le QR code est bien g√©n√©r√© avant de passer √† l'√©tape 9
                        if (currentQRCodeData && currentQRCodeData.length > 0) {
                            console.log('Passage √† l\'√©tape 9...');
                                currentStep = 9;
                                showStep(currentStep);
                                updateProgressIndicators();
                                updateNavigation();
                                showFinalSummary();
                        } else {
                            console.error('currentQRCodeData est vide ou invalide');
                            showError('Le QR code n\'a pas pu √™tre g√©n√©r√©. Veuillez r√©essayer.');
                            const activeStep = document.querySelector('.workflow-content.active');
                            const retryBtn = activeStep ? (activeStep.querySelector('#nextBtn') || activeStep.querySelector('.nav-btn.next')) : null;
                            if (retryBtn) {
                                retryBtn.disabled = false;
                                retryBtn.textContent = 'Suivant ‚Üí';
                            }
                        }
                    }, 100);
                            }).catch((error) => {
                    console.error('Erreur generation QR dynamique:', error);
                    showError('Erreur lors de la g√©n√©ration du QR code dynamique');
                    const activeStep = document.querySelector('.workflow-content.active');
                    const retryBtn = activeStep ? (activeStep.querySelector('#nextBtn') || activeStep.querySelector('.nav-btn.next')) : null;
                    if (retryBtn) {
                        retryBtn.disabled = false;
                        retryBtn.textContent = 'Suivant ‚Üí';
                                }
                            });
                return;
                    }
            
            // Navigation normale pour les autres √©tapes
            if (currentStep < 9) {
                currentStep++;
                showStep(currentStep);
                updateProgressIndicators();
                updateNavigation();
                
                    // Si on arrive √† l'√©tape 9, afficher le r√©sum√© final
                    if (currentStep === 9) {
                        console.log('Etape 9 atteinte, affichage du resume final');
                        showFinalSummary();
                }
            }
        }

        function prevStep() {
            if (currentStep > 1) {
                currentStep--;
                showStep(currentStep);
                updateProgressIndicators();
                updateNavigation();
            }
        }

        function showStep(stepNumber) {
            // Cacher tous les steps et leurs navigations
            document.querySelectorAll('.workflow-content').forEach(content => {
                content.classList.remove('active');
                content.style.display = 'none';
            });
            
            // Cacher toutes les navigations
            document.querySelectorAll('.navigation').forEach(nav => {
                nav.style.display = 'none';
            });
            
            if (stepNumber === 'result') {
                document.getElementById('result-step').style.display = 'block';
                document.getElementById('result-step').classList.add('active');
            } else {
                const step = document.getElementById(`step-${stepNumber}`);
                if (step) {
                    step.style.display = 'block';
                    step.classList.add('active');
                    // Afficher uniquement la navigation du step actif
                    const navigation = step.querySelector('.navigation');
                    if (navigation) {
                        navigation.style.display = 'flex';
                    }
                }
            }
        }

        function updateProgressIndicators() {
            document.querySelectorAll('.progress-step').forEach(step => {
                const stepNumber = parseInt(step.dataset.step);
                step.classList.remove('active', 'completed');
                
                if (stepNumber === currentStep) {
                    step.classList.add('active');
                } else if (stepNumber < currentStep) {
                    step.classList.add('completed');
                }
            });
        }

        function updateNavigation() {
            // Trouver le step actif
            const activeStep = document.querySelector('.workflow-content.active');
            if (!activeStep) return;
            
            // Trouver les boutons dans le step actif uniquement
            const prevBtn = activeStep.querySelector('#prevBtn') || activeStep.querySelector('.nav-btn.prev');
            const nextBtn = activeStep.querySelector('#nextBtn') || activeStep.querySelector('.nav-btn.next');
            
            if (!prevBtn || !nextBtn) return;
            
            prevBtn.style.display = currentStep > 1 ? 'block' : 'none';
            
            // Cacher le bouton suivant √† l'√©tape 9 (derni√®re √©tape)
                if (currentStep >= 9) {
                    nextBtn.style.display = 'none';
                return;
            }
            
            if (workflowState.isDynamic) {
                // QR Code Dynamique
                    nextBtn.style.display = 'block';
                    if (currentStep === 7) {
                    nextBtn.textContent = 'G√©n√©rer le QR Code ‚Üí';
                        nextBtn.className = 'nav-btn next finalize';
                } else if (currentStep === 8) {
                    nextBtn.style.display = 'none'; // Pas de bouton, g√©n√©ration automatique
                    } else {
                    nextBtn.textContent = 'Suivant ‚Üí';
                        nextBtn.className = 'nav-btn next';
                }
            } else {
                // QR Code Statique
                    nextBtn.style.display = 'block';
                    if (currentStep === 7) {
                    nextBtn.textContent = 'G√©n√©rer ‚Üí';
                        nextBtn.className = 'nav-btn next finalize';
                    } else {
                        nextBtn.textContent = 'Suivant ‚Üí';
                        nextBtn.className = 'nav-btn next';
                }
            }
        }

        function validateCurrentStep() {
            switch (currentStep) {
                case 1:
                    if (!workflowState.style) {
                        showError('Veuillez s√©lectionner un style de QR code');
                        return false;
                    }
                    break;
                case 2:
                    if (!workflowState.content.trim()) {
                        showError('Veuillez saisir le contenu du QR code');
                        return false;
                    }
                    break;
                case 3:
                    if (!workflowState.size) {
                        showError('Veuillez s√©lectionner une taille');
                        return false;
                    }
                    break;
                case 4:
                    // Pas de validation sp√©ciale pour les couleurs
                    break;
                case 5:
                    // Pas de validation sp√©ciale pour le logo (optionnel)
                    break;
                case 6:
                    // Pas de validation sp√©ciale pour la personnalisation
                    break;
                case 7:
                    // Configuration finale - valider le nom pour les QR dynamiques
                    if (workflowState.isDynamic && !workflowState.name.trim()) {
                        showError('Veuillez saisir un nom pour votre QR code dynamique');
                        return false;
                    }
                    break;
                case 8:
                    // QR code dynamique - pas de validation sp√©ciale
                    break;
            }
            return true;
        }

        function showError(message) {
            // Supprimer les messages d'erreur existants
            document.querySelectorAll('.error-message').forEach(msg => msg.remove());
            
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-message';
            errorDiv.textContent = message;
            
            const currentStepElement = document.querySelector('.workflow-content.active');
            currentStepElement.appendChild(errorDiv);
            
            setTimeout(() => {
                errorDiv.remove();
            }, 5000);
        }

        function showSuccess(message) {
            // Supprimer les messages de succ√®s existants
            document.querySelectorAll('.success-message').forEach(msg => msg.remove());
            
            const successDiv = document.createElement('div');
            successDiv.className = 'success-message';
            successDiv.textContent = message;
            
            const currentStepElement = document.querySelector('.workflow-content.active');
            currentStepElement.appendChild(successDiv);
            
            setTimeout(() => {
                successDiv.remove();
            }, 5000);
        }

        async function generateStaticQRCode() {
            try {
                // Formater le contenu selon le type choisi
                const formattedContent = formatContentForQR(workflowState.content, workflowState.contentType);
                
                // Utiliser toujours l'URL relative (fonctionne en production et d√©veloppement)
                const response = await fetch('/api/qr/static', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        content: formattedContent,
                        size: workflowState.size,
                        qr_color: workflowState.foregroundColor,
                        bg_color: workflowState.backgroundColor,
                        error_correction: workflowState.errorCorrection,
                        margin: workflowState.margin,
                        logo: workflowState.logo
                    })
                });

                const result = await response.json();

                if (result.success) {
                    // Stocker les donn√©es globalement
                    currentQRCodeData = result.qr_code;
                    currentQRCodeId = 'static-qr';
                    currentManagementToken = null;
                    currentManagementUrl = null;
                    currentRedirectUrl = null;
                    
                    // Afficher le QR code
                    document.getElementById('qr-preview-placeholder').style.display = 'none';
                    document.getElementById('qr-preview-img').src = 'data:image/png;base64,' + result.qr_code;
                    document.getElementById('qr-preview-img').style.display = 'block';

                    // Ajouter un bouton de t√©l√©chargement
                    addDownloadButton(result.qr_code, 'static-qr');

                    showSuccess('QR code statique cr√©√© avec succ√®s !');
                    return Promise.resolve();
                } else {
                    showError('Erreur lors de la cr√©ation du QR code : ' + result.error);
                    return Promise.reject(new Error(result.error));
                }
            } catch (error) {
                console.error('Erreur:', error);
                showError('Erreur lors de la cr√©ation du QR code');
                return Promise.reject(error);
            }
        }

        async function generateDynamicQRCode() {
            try {
                console.log('=== GENERATION QR DYNAMIQUE ===');
                console.log('Workflow state:', workflowState);
                
                // Formater le contenu selon le type choisi
                const formattedContent = formatContentForQR(workflowState.content, workflowState.contentType);
                console.log('Contenu formate:', formattedContent);
                
                const requestData = {
                    content: formattedContent,
                    url: formattedContent,
                    name: workflowState.name || 'Mon QR Code',
                    size: workflowState.size,
                    qr_color: workflowState.foregroundColor,
                    bg_color: workflowState.backgroundColor,
                    error_correction: workflowState.errorCorrection,
                    margin: workflowState.margin,
                    logo: workflowState.logo
                };
                console.log('Donnees envoyees:', requestData);
                
                // Utiliser toujours l'URL relative (fonctionne en production et d√©veloppement)
                const response = await fetch('/api/dynamic/qr', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestData)
                });

                console.log('Reponse API dynamique:', response.status, response.statusText);
                const result = await response.json();
                console.log('Resultat API dynamique:', result);

                if (result.success) {
                    console.log('QR code g√©n√©r√© avec succ√®s:', result);
                    console.log('Longueur du QR code base64:', result.qr_code ? result.qr_code.length : 0);
                    
                    // Stocker les donn√©es globalement
                    currentQRCodeData = result.qr_code;
                    currentQRCodeId = result.qr_id;
                    currentManagementToken = result.management_token;
                    currentManagementUrl = result.management_url;
                    currentRedirectUrl = result.redirect_url;
                    
                    console.log('QR code g√©n√©r√© et stock√©. Longueur:', currentQRCodeData ? currentQRCodeData.length : 0);
                    console.log('Passage automatique √† l\'√©tape 9...');
                    
                    // Ne pas afficher ici, on va passer √† l'√©tape 9 qui l'affichera
                    return Promise.resolve();
                } else {
                    showError('Erreur lors de la cr√©ation du QR code : ' + result.error);
                    return Promise.reject(new Error(result.error));
                }
            } catch (error) {
                console.error('Erreur:', error);
                showError('Erreur lors de la cr√©ation du QR code');
                return Promise.reject(error);
            }
        }

        function addDownloadButton(qrCodeBase64, qrId) {
            const qrPreview = document.querySelector('.qr-preview');
            
            // Supprimer l'ancien bouton s'il existe
            const existingBtn = document.getElementById('download-btn');
            if (existingBtn) {
                existingBtn.remove();
            }

            // Cr√©er le bouton de t√©l√©chargement
            const downloadBtn = document.createElement('button');
            downloadBtn.id = 'download-btn';
            downloadBtn.className = 'nav-btn generate';
            downloadBtn.style.marginTop = '20px';
            downloadBtn.textContent = 'üì• T√©l√©charger le QR Code';
            downloadBtn.onclick = () => downloadQRCode(qrCodeBase64, qrId);
            
            qrPreview.appendChild(downloadBtn);
        }

        function downloadQRCode(qrCodeBase64, qrId) {
            const link = document.createElement('a');
            link.href = 'data:image/png;base64,' + qrCodeBase64;
            link.download = `qr-code-${workflowState.isDynamic ? 'dynamique' : 'statique'}-${qrId}.png`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Variables globales pour stocker les donn√©es du QR code g√©n√©r√©
        let currentQRCodeData = null;
        let currentQRCodeId = null;
        let currentManagementToken = null;
        let currentManagementUrl = null;
        let currentRedirectUrl = null;

        function formatContentForQR(content, contentType) {
            if (!content || !contentType) {
                return content;
            }

            switch (contentType) {
                case 'url':
                    // S'assurer que l'URL commence par http:// ou https://
                    if (!content.startsWith('http://') && !content.startsWith('https://')) {
                        return 'https://' + content;
                    }
                    return content;
                
                case 'email':
                    // Format email pour QR code
                    return `mailto:${content}`;
                
                case 'phone':
                    // Format t√©l√©phone pour QR code
                    return `tel:${content}`;
                
                case 'sms':
                    // Format SMS pour QR code
                    return `sms:${content}`;
                
                case 'vcard':
                    // Format vCard basique
                    return `BEGIN:VCARD
VERSION:3.0
FN:${content}
END:VCARD`;
                
                case 'wifi':
                    // Format WiFi pour QR code (exemple basique)
                    return `WIFI:T:WPA;S:${content};P:password;;`;
                
                case 'location':
                    // Format g√©olocalisation (exemple)
                    return `geo:0,0?q=${encodeURIComponent(content)}`;
                
                case 'text':
                default:
                    // Texte brut, pas de formatage
                    return content;
            }
        }

        function updateContentPlaceholder() {
            const contentInput = document.getElementById('content-input');
            const contentType = workflowState.contentType;
            
            switch (contentType) {
                case 'url':
                    contentInput.placeholder = 'Exemple: google.com ou https://example.com';
                    break;
                case 'email':
                    contentInput.placeholder = 'Exemple: contact@example.com';
                    break;
                case 'phone':
                    contentInput.placeholder = 'Exemple: +33123456789';
                    break;
                case 'sms':
                    contentInput.placeholder = 'Exemple: +33123456789';
                    break;
                case 'vcard':
                    contentInput.placeholder = 'Exemple: Jean Dupont';
                    break;
                case 'wifi':
                    contentInput.placeholder = 'Exemple: MonWiFi';
                    break;
                case 'location':
                    contentInput.placeholder = 'Exemple: Paris, France';
                    break;
                case 'text':
                default:
                    contentInput.placeholder = 'Entrez votre contenu ici...';
                    break;
            }
        }

        function showFinalSummary() {
            console.log('=== showFinalSummary() appel√©e ===');
            console.log('currentQRCodeData existe:', !!currentQRCodeData);
            console.log('currentQRCodeData longueur:', currentQRCodeData ? currentQRCodeData.length : 0);
            
            // Afficher le QR code √† l'√©tape 9
            const placeholderFinal = document.getElementById('qr-preview-placeholder-final');
            const imgFinal = document.getElementById('qr-preview-img-final');
            
            console.log('placeholderFinal trouv√©:', !!placeholderFinal);
            console.log('imgFinal trouv√©:', !!imgFinal);
            
            if (currentQRCodeData && currentQRCodeData.length > 0) {
                // Afficher le QR code g√©n√©r√©
                if (placeholderFinal) {
                    placeholderFinal.style.display = 'none';
                    console.log('Placeholder cach√©');
                }
                if (imgFinal) {
                    imgFinal.src = 'data:image/png;base64,' + currentQRCodeData;
                    imgFinal.style.display = 'block';
                    console.log('QR code affich√© √† l\'√©tape 9 - src d√©fini et display:block');
                } else {
                    console.error('imgFinal n\'existe pas dans le DOM!');
                }
            } else {
                // Afficher le placeholder si le QR code n'est pas encore g√©n√©r√©
                console.warn('currentQRCodeData est vide ou invalide');
                if (placeholderFinal) {
                    placeholderFinal.style.display = 'block';
                    console.log('Placeholder affich√© (QR code non disponible)');
                }
                if (imgFinal) {
                    imgFinal.style.display = 'none';
                }
            }
            
            // Afficher le r√©sum√©
            const qrSummary = document.getElementById('qr-summary');
            if (qrSummary) {
                qrSummary.style.display = 'block';
            
            // Remplir les informations du r√©sum√©
                const summaryType = document.getElementById('summary-type');
                const summaryContent = document.getElementById('summary-content');
                const summarySize = document.getElementById('summary-size');
                const summaryColors = document.getElementById('summary-colors');
                
                if (summaryType) summaryType.textContent = workflowState.isDynamic ? 'QR Code Dynamique' : 'QR Code Statique';
                if (summaryContent) summaryContent.textContent = workflowState.content;
                if (summarySize) summarySize.textContent = workflowState.size;
                if (summaryColors) summaryColors.textContent = `${workflowState.foregroundColor} sur ${workflowState.backgroundColor}`;
            
            // Afficher les informations de gestion pour les QR codes dynamiques
            if (workflowState.isDynamic && currentManagementUrl && currentRedirectUrl) {
                const managementDiv = document.getElementById('summary-management');
                    if (managementDiv) {
                managementDiv.style.display = 'block';
                        const mgmtUrlEl = document.getElementById('summary-management-url');
                        const redirectUrlEl = document.getElementById('summary-redirect-url');
                        if (mgmtUrlEl) mgmtUrlEl.textContent = currentManagementUrl;
                        if (redirectUrlEl) redirectUrlEl.textContent = currentRedirectUrl;
                    }
                }
            }
        }

        function downloadCurrentQRCode() {
            if (currentQRCodeData && currentQRCodeId) {
                downloadQRCode(currentQRCodeData, currentQRCodeId);
            } else {
                showError('Aucun QR code √† t√©l√©charger');
            }
        }

        function shareQRCode() {
            if (workflowState.isDynamic && currentRedirectUrl) {
                navigator.clipboard.writeText(currentRedirectUrl).then(() => {
                    showSuccess('Lien copi√© dans le presse-papiers !');
                }).catch(() => {
                    showError('Impossible de copier le lien');
                });
            } else {
                showError('Le partage n\'est disponible que pour les QR codes dynamiques');
            }
        }

        function manageQRCode() {
            if (workflowState.isDynamic && currentManagementUrl) {
                window.open(currentManagementUrl, '_blank');
            } else {
                showError('La gestion n\'est disponible que pour les QR codes dynamiques');
            }
        }

        function createNewQRCode() {
            resetWorkflow();
            showStep(1);
            updateProgressIndicators();
            updateNavigation();
        }

        function finishWorkflow() {
            // Optionnel : rediriger vers une page de confirmation ou fermer le modal
            showSuccess('Workflow termin√© avec succ√®s !');
            
            // R√©initialiser apr√®s un d√©lai
            setTimeout(() => {
                createNewQRCode();
            }, 2000);
        }

        function resetWorkflow() {
            currentStep = 1;
            workflowState = {
                style: null,
                content: '',
                contentType: 'url',
                size: 300,
                foregroundColor: '#000000',
                backgroundColor: '#FFFFFF',
                logo: null,
                errorCorrection: 'M',
                margin: 4,
                name: '',
                email: '',
                isDynamic: false
            };
            
            // R√©initialiser les variables globales
            currentQRCodeData = null;
            currentQRCodeId = null;
            currentManagementToken = null;
            currentManagementUrl = null;
            currentRedirectUrl = null;

            // R√©initialiser l'interface
            document.querySelectorAll('.style-card').forEach(card => card.classList.remove('selected'));
            document.querySelectorAll('.size-btn').forEach(btn => btn.classList.remove('selected'));
            const defaultSizeBtn = document.querySelector('.size-btn[data-size="300"]');
            if (defaultSizeBtn) defaultSizeBtn.classList.add('selected');
            
            // R√©initialiser les champs s'ils existent
            const contentInput = document.getElementById('content-input');
            if (contentInput) contentInput.value = '';
            
            const qrName = document.getElementById('qr-name');
            if (qrName) qrName.value = '';
            
            const userEmail = document.getElementById('user-email');
            if (userEmail) userEmail.value = '';
            
            const foregroundColor = document.getElementById('foreground-color');
            if (foregroundColor) foregroundColor.value = '#000000';
            
            const backgroundColor = document.getElementById('background-color');
            if (backgroundColor) backgroundColor.value = '#FFFFFF';
            
            const errorCorrection = document.getElementById('error-correction');
            if (errorCorrection) errorCorrection.value = 'M';
            
            const margin = document.getElementById('margin');
            if (margin) margin.value = '4';
            
            const marginValue = document.getElementById('margin-value');
            if (marginValue) marginValue.textContent = '4';
            
            // Masquer les informations de gestion
            const managementInfo = document.getElementById('management-info');
            if (managementInfo) managementInfo.style.display = 'none';
            
            const qrPreviewImg = document.getElementById('qr-preview-img');
            if (qrPreviewImg) qrPreviewImg.style.display = 'none';
            
            const qrPreviewPlaceholder = document.getElementById('qr-preview-placeholder');
            if (qrPreviewPlaceholder) qrPreviewPlaceholder.style.display = 'flex';
            
            showStep(1);
            updateProgressIndicators();
            updateNavigation();
        }
    </script>
</body>
</html>
-- H2 2.3.232; 
SET DB_CLOSE_DELAY -1;         
;              
CREATE USER IF NOT EXISTS "SA" SALT '870bac407ba28a81' HASH '50a4986d381668661cb2c4cfe645563c97d56ba82cde8f15e018044ba14583f7' ADMIN;          
DROP TABLE IF EXISTS "PUBLIC"."AUDIT_EVENTS" CASCADE;          
DROP TABLE IF EXISTS "PUBLIC"."AUTHORITIES" CASCADE;           
DROP TABLE IF EXISTS "PUBLIC"."INVITE_TOKENS" CASCADE;         
DROP TABLE IF EXISTS "PUBLIC"."PERSISTENT_LOGINS" CASCADE;     
DROP TABLE IF EXISTS "PUBLIC"."SESSIONS" CASCADE;              
DROP TABLE IF EXISTS "PUBLIC"."TEAMS" CASCADE; 
DROP TABLE IF EXISTS "PUBLIC"."USER_LICENSE_SETTINGS" CASCADE; 
DROP TABLE IF EXISTS "PUBLIC"."USER_SETTINGS" CASCADE;         
DROP TABLE IF EXISTS "PUBLIC"."USERS" CASCADE; 
CREATE CACHED TABLE "PUBLIC"."AUDIT_EVENTS"(
    "ID" BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL,
    "DATA" CHARACTER LARGE OBJECT,
    "PRINCIPAL" CHARACTER VARYING(255),
    "TIMESTAMP" TIMESTAMP(6) WITH TIME ZONE,
    "TYPE" CHARACTER VARYING(255)
);             
ALTER TABLE "PUBLIC"."AUDIT_EVENTS" ADD CONSTRAINT "PUBLIC"."CONSTRAINT_C" PRIMARY KEY("ID");  
-- 0 +/- SELECT COUNT(*) FROM PUBLIC.AUDIT_EVENTS;             
CREATE INDEX "PUBLIC"."IDX_AUDIT_TIMESTAMP" ON "PUBLIC"."AUDIT_EVENTS"("TIMESTAMP" NULLS FIRST);               
CREATE INDEX "PUBLIC"."IDX_AUDIT_PRINCIPAL" ON "PUBLIC"."AUDIT_EVENTS"("PRINCIPAL" NULLS FIRST);               
CREATE INDEX "PUBLIC"."IDX_AUDIT_TYPE" ON "PUBLIC"."AUDIT_EVENTS"("TYPE" NULLS FIRST);         
CREATE INDEX "PUBLIC"."IDX_AUDIT_PRINCIPAL_TYPE" ON "PUBLIC"."AUDIT_EVENTS"("PRINCIPAL" NULLS FIRST, "TYPE" NULLS FIRST);      
CREATE INDEX "PUBLIC"."IDX_AUDIT_TYPE_TIMESTAMP" ON "PUBLIC"."AUDIT_EVENTS"("TYPE" NULLS FIRST, "TIMESTAMP" NULLS FIRST);      
CREATE CACHED TABLE "PUBLIC"."AUTHORITIES"(
    "ID" BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1 RESTART WITH 3) NOT NULL,
    "AUTHORITY" CHARACTER VARYING(255),
    "USER_ID" BIGINT
);            
ALTER TABLE "PUBLIC"."AUTHORITIES" ADD CONSTRAINT "PUBLIC"."CONSTRAINT_A" PRIMARY KEY("ID");   
-- 2 +/- SELECT COUNT(*) FROM PUBLIC.AUTHORITIES;              
INSERT INTO "PUBLIC"."AUTHORITIES"("ID", "AUTHORITY", "USER_ID") VALUES(1, 'ROLE_ADMIN', 1);   
INSERT INTO "PUBLIC"."AUTHORITIES"("ID", "AUTHORITY", "USER_ID") VALUES(2, 'STIRLING-PDF-BACKEND-API-USER', 2);
CREATE CACHED TABLE "PUBLIC"."INVITE_TOKENS"(
    "ID" BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL,
    "CREATED_AT" TIMESTAMP(6),
    "CREATED_BY" CHARACTER VARYING(255) NOT NULL,
    "EMAIL" CHARACTER VARYING(255),
    "EXPIRES_AT" TIMESTAMP(6) NOT NULL,
    "ROLE" CHARACTER VARYING(50) NOT NULL,
    "TEAM_ID" BIGINT,
    "TOKEN" CHARACTER VARYING(100) NOT NULL,
    "USED" BOOLEAN NOT NULL,
    "USED_AT" TIMESTAMP(6)
);   
ALTER TABLE "PUBLIC"."INVITE_TOKENS" ADD CONSTRAINT "PUBLIC"."CONSTRAINT_E" PRIMARY KEY("ID"); 
-- 0 +/- SELECT COUNT(*) FROM PUBLIC.INVITE_TOKENS;            
CREATE CACHED TABLE "PUBLIC"."PERSISTENT_LOGINS"(
    "SERIES" CHARACTER VARYING(255) NOT NULL,
    "LAST_USED" TIMESTAMP(6) WITH TIME ZONE NOT NULL,
    "TOKEN" CHARACTER VARYING(64) NOT NULL,
    "USERNAME" CHARACTER VARYING(64) NOT NULL
);             
ALTER TABLE "PUBLIC"."PERSISTENT_LOGINS" ADD CONSTRAINT "PUBLIC"."CONSTRAINT_A3" PRIMARY KEY("SERIES");        
-- 0 +/- SELECT COUNT(*) FROM PUBLIC.PERSISTENT_LOGINS;        
CREATE CACHED TABLE "PUBLIC"."SESSIONS"(
    "SESSION_ID" CHARACTER VARYING(255) NOT NULL,
    "EXPIRED" BOOLEAN NOT NULL,
    "LAST_REQUEST" TIMESTAMP(6) WITH TIME ZONE,
    "PRINCIPAL_NAME" CHARACTER VARYING(255)
);      
ALTER TABLE "PUBLIC"."SESSIONS" ADD CONSTRAINT "PUBLIC"."CONSTRAINT_8" PRIMARY KEY("SESSION_ID");              
-- 0 +/- SELECT COUNT(*) FROM PUBLIC.SESSIONS; 
CREATE CACHED TABLE "PUBLIC"."TEAMS"(
    "TEAM_ID" BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1 RESTART WITH 3) NOT NULL,
    "NAME" CHARACTER VARYING(255) NOT NULL
);               
ALTER TABLE "PUBLIC"."TEAMS" ADD CONSTRAINT "PUBLIC"."CONSTRAINT_4" PRIMARY KEY("TEAM_ID");    
-- 2 +/- SELECT COUNT(*) FROM PUBLIC.TEAMS;    
INSERT INTO "PUBLIC"."TEAMS"("TEAM_ID", "NAME") VALUES(1, 'Default');          
INSERT INTO "PUBLIC"."TEAMS"("TEAM_ID", "NAME") VALUES(2, 'Internal');         
CREATE CACHED TABLE "PUBLIC"."USER_LICENSE_SETTINGS"(
    "ID" BIGINT NOT NULL,
    "GRANDFATHERED_USER_COUNT" INTEGER NOT NULL,
    "GRANDFATHERED_USER_SIGNATURE" CHARACTER VARYING(256) NOT NULL,
    "GRANDFATHERING_LOCKED" BOOLEAN NOT NULL,
    "INTEGRITY_SALT" CHARACTER VARYING(64) NOT NULL,
    "LICENSE_MAX_USERS" INTEGER NOT NULL
);            
ALTER TABLE "PUBLIC"."USER_LICENSE_SETTINGS" ADD CONSTRAINT "PUBLIC"."CONSTRAINT_9" PRIMARY KEY("ID");         
-- 0 +/- SELECT COUNT(*) FROM PUBLIC.USER_LICENSE_SETTINGS;    
CREATE CACHED TABLE "PUBLIC"."USER_SETTINGS"(
    "USER_ID" BIGINT NOT NULL,
    "SETTING_VALUE" CHARACTER VARYING,
    "SETTING_KEY" CHARACTER VARYING(255) NOT NULL
);       
ALTER TABLE "PUBLIC"."USER_SETTINGS" ADD CONSTRAINT "PUBLIC"."CONSTRAINT_9A" PRIMARY KEY("USER_ID", "SETTING_KEY");            
-- 0 +/- SELECT COUNT(*) FROM PUBLIC.USER_SETTINGS;            
CREATE CACHED TABLE "PUBLIC"."USERS"(
    "USER_ID" BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1 RESTART WITH 3) NOT NULL,
    "API_KEY" CHARACTER VARYING(255),
    "AUTHENTICATIONTYPE" CHARACTER VARYING(255),
    "CREATED_AT" TIMESTAMP(6),
    "ENABLED" BOOLEAN,
    "FORCE_PASSWORD_CHANGE" BOOLEAN,
    "HAS_COMPLETED_INITIAL_SETUP" BOOLEAN,
    "IS_FIRST_LOGIN" BOOLEAN,
    "OAUTH_GRANDFATHERED" BOOLEAN,
    "PASSWORD" CHARACTER VARYING(255),
    "ROLE_NAME" CHARACTER VARYING(255),
    "SSO_PROVIDER" CHARACTER VARYING(255),
    "SSO_PROVIDER_ID" CHARACTER VARYING(255),
    "UPDATED_AT" TIMESTAMP(6),
    "USERNAME" CHARACTER VARYING(255),
    "TEAM_ID" BIGINT
);         
ALTER TABLE "PUBLIC"."USERS" ADD CONSTRAINT "PUBLIC"."CONSTRAINT_4D" PRIMARY KEY("USER_ID");   
-- 2 +/- SELECT COUNT(*) FROM PUBLIC.USERS;    
INSERT INTO "PUBLIC"."USERS"("USER_ID", "API_KEY", "AUTHENTICATIONTYPE", "CREATED_AT", "ENABLED", "FORCE_PASSWORD_CHANGE", "HAS_COMPLETED_INITIAL_SETUP", "IS_FIRST_LOGIN", "OAUTH_GRANDFATHERED", "PASSWORD", "ROLE_NAME", "SSO_PROVIDER", "SSO_PROVIDER_ID", "UPDATED_AT", "USERNAME", "TEAM_ID") VALUES(1, NULL, 'web', TIMESTAMP '2025-12-23 16:50:12.514486', TRUE, FALSE, FALSE, TRUE, FALSE, '$2a$10$YLOLWENUDKEPKecHHBfdfOsk.44qfx6IcJdWwvjgGR9exMJ2KcW3a', NULL, NULL, NULL, TIMESTAMP '2025-12-23 16:50:12.514519', 'admin', 1);     
INSERT INTO "PUBLIC"."USERS"("USER_ID", "API_KEY", "AUTHENTICATIONTYPE", "CREATED_AT", "ENABLED", "FORCE_PASSWORD_CHANGE", "HAS_COMPLETED_INITIAL_SETUP", "IS_FIRST_LOGIN", "OAUTH_GRANDFATHERED", "PASSWORD", "ROLE_NAME", "SSO_PROVIDER", "SSO_PROVIDER_ID", "UPDATED_AT", "USERNAME", "TEAM_ID") VALUES(2, 'd0491467-3eb3-4442-803c-844abab91c54', 'web', TIMESTAMP '2025-12-23 16:50:12.608215', TRUE, FALSE, FALSE, FALSE, FALSE, '$2a$10$AP91npr3tngYjPL0yPgDr.kNYvnTHRxzDsr6Ewnkx/ixfCf2rYdDW', NULL, NULL, NULL, TIMESTAMP '2025-12-23 16:50:12.653018', 'STIRLING-PDF-BACKEND-API-USER', 2);          
ALTER TABLE "PUBLIC"."USERS" ADD CONSTRAINT "PUBLIC"."UKR43AF9AP4EDM43MMTQ01ODDJ6" UNIQUE NULLS DISTINCT ("USERNAME");         
ALTER TABLE "PUBLIC"."TEAMS" ADD CONSTRAINT "PUBLIC"."UKA510NO6SJWQCX153YD5SM4JRR" UNIQUE NULLS DISTINCT ("NAME");             
ALTER TABLE "PUBLIC"."INVITE_TOKENS" ADD CONSTRAINT "PUBLIC"."UKEWCI50C0NCFIIHR2TC41NFBNF" UNIQUE NULLS DISTINCT ("TOKEN");    
ALTER TABLE "PUBLIC"."AUTHORITIES" ADD CONSTRAINT "PUBLIC"."FKK91UPMBUEYIM93V469WJ7B2QH" FOREIGN KEY("USER_ID") REFERENCES "PUBLIC"."USERS"("USER_ID") NOCHECK;
ALTER TABLE "PUBLIC"."USER_SETTINGS" ADD CONSTRAINT "PUBLIC"."FK8V82NJ88RMAI0NYCK19F873DW" FOREIGN KEY("USER_ID") REFERENCES "PUBLIC"."USERS"("USER_ID") NOCHECK;              
ALTER TABLE "PUBLIC"."USERS" ADD CONSTRAINT "PUBLIC"."FKFJWS1RDRUAB2BQG7QIPOQF65R" FOREIGN KEY("TEAM_ID") REFERENCES "PUBLIC"."TEAMS"("TEAM_ID") NOCHECK;      
